<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animals Picture - Local</title>
    <meta name="description" content="Rede social local.">
    <meta name="theme-color" content="#121212">
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6566744182494017" crossorigin="anonymous"></script>

    <style>
        /* === ESTILOS === */
        :root { --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --border: #333; --green: #00C853; --red: #D50000; --gold: #FFD700; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        header { width: 100%; height: 70px; background: var(--card); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-sizing: border-box; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 22px; font-weight: 800; color: var(--green); margin: 0; }
        .logo span { color: #fff; }
        .header-actions { display: flex; align-items: center; gap: 12px; }

        .btn-icon { background: transparent; border: 1px solid var(--border); color: var(--text); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: 0.2s; }
        .btn-icon:hover { background: #333; border-color: var(--green); }
        .btn-premium { border-color: var(--gold); color: var(--gold); background: rgba(255, 215, 0, 0.1); }
        .user-mini img { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--green); cursor: pointer; object-fit: cover; }
        
        .topic-bar { width: 100%; background: var(--bg); border-bottom: 1px solid var(--border); display: flex; gap: 10px; padding: 12px; overflow-x: auto; position: sticky; top: 70px; z-index: 90; }
        .topic-btn { background: var(--card); border: 1px solid var(--border); color: #aaa; padding: 8px 18px; border-radius: 20px; cursor: pointer; white-space: nowrap; flex-shrink: 0; }
        .topic-btn.active { background: var(--green); color: white; border-color: var(--green); }

        main { width: 100%; max-width: 600px; padding: 20px 10px; padding-bottom: 80px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 25px; }
        
        input, textarea, select { width: 100%; background: #2c2c2c; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 8px; margin: 8px 0; box-sizing: border-box; font-family: inherit; }
        .btn-green { width: 100%; background: var(--green); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .file-upload-label { display: flex; align-items: center; justify-content: center; gap: 10px; background: #2c2c2c; border: 1px dashed #666; padding: 15px; border-radius: 8px; cursor: pointer; color: #aaa; font-size: 14px; margin: 10px 0; }
        #previewUpload { width: 100%; border-radius: 8px; margin-top: 10px; display: none; object-fit: contain; max-height: 300px; }

        .post img { width: 100%; border-radius: 10px; margin-top: 10px; }
        .post-header { display: flex; align-items: center; justify-content: space-between; }
        .post-user { display: flex; align-items: center; gap: 10px; }
        .post-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .badge-admin { background: var(--red); color: white; font-size: 9px; padding: 2px 6px; border-radius: 4px; margin-left: 5px; font-weight: bold; }
        
        .post-comments { margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; }
        .comment-item { display: flex; gap: 10px; margin-bottom: 10px; }
        .comment-avatar { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
        .comment-text { font-size: 13px; color: #ccc; background: #252525; padding: 8px; border-radius: 8px; flex: 1; word-break: break-word; }
        .comment-form { display: flex; gap: 8px; margin-top: 10px; }
        .btn-comment { background: var(--green); border: none; color: white; border-radius: 8px; padding: 0 15px; cursor: pointer; }

        .modal-bg { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center; }
        .modal-bg.open { display: flex; }
        .modal-box { background: var(--card); width: 90%; max-width: 400px; padding: 25px; border-radius: 16px; border: 1px solid var(--border); position: relative; max-height: 80vh; overflow-y: auto; }
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer; color: #888; }
        
        .config-section { border-top: 1px solid #333; margin-top: 15px; padding-top: 15px; }
        .premium-border { border: 2px solid var(--gold) !important; }
        .admin-border { border: 2px solid var(--red) !important; }
        .post-ad { border: 2px dashed #444; background: #000; text-align: center; }
    </style>
</head>
<body>

    <header>
        <div class="logo">Animals <span>Picture</span></div>
        <div class="header-actions">
            <button class="btn-icon btn-premium" onclick="abrirModal('modalPremium')">üíé</button>
            <button class="btn-icon" onclick="abrirModal('modalConfig')">‚öôÔ∏è</button>
            <div id="googleBtn"></div>
            <div class="user-mini" id="loggedArea" onclick="abrirModal('modalPerfil')" style="display:none;">
                <img id="headerImg" src="" alt="Eu">
            </div>
        </div>
    </header>

    <nav id="topicBar" class="topic-bar">
        <button class="topic-btn active" onclick="filtrarFeed('Tudo', this)">Tudo</button>
    </nav>

    <main>
        <div id="postBox" class="card" style="display:none;">
            <h3>Nova Publica√ß√£o üêæ</h3>
            <form onsubmit="publicar(event)">
                <textarea id="descPost" rows="2" placeholder="Escreva algo..." required></textarea>
                
                <div style="display:flex; gap:10px; margin:10px 0;">
                    <select id="catSelect" required onchange="carregarSub()"><option value="">Categoria...</option></select>
                    <select id="subSelect" disabled required><option value="">Ra√ßa...</option></select>
                </div>

                <label class="file-upload-label">
                    <input type="file" id="fileInput" accept="image/*" style="display:none;" onchange="lerArquivo(this)">
                    <span>üì∑ C√¢mera / Galeria</span>
                </label>
                <img id="previewUpload" src="">
                <input type="hidden" id="finalImageBase64">

                <button class="btn-green">Publicar</button>
                <div id="limitDisplay" style="font-size:12px; color:#888; margin-top:5px; text-align:center;"></div>
            </form>
        </div>

        <div id="feed"></div>
    </main>

    <div id="modalPremium" class="modal-bg">
        <div class="modal-box">
            <span class="close-btn" onclick="fecharModal('modalPremium')">&times;</span>
            <h2 style="color:var(--gold)">Premium üíé</h2>
            <p>R$ 2,99 / m√™s</p>
            <button class="btn-green" style="background:var(--gold); color:black;" onclick="assinarPremium()">Assinar Agora</button>
        </div>
    </div>

    <div id="modalPerfil" class="modal-bg">
        <div class="modal-box">
            <span class="close-btn" onclick="fecharModal('modalPerfil')">&times;</span>
            <h3>Meu Perfil</h3>
            <img id="previewImg" src="" style="width:80px; height:80px; border-radius:50%; margin:10px auto; display:block; object-fit:cover;">
            <input type="text" id="editNome" placeholder="Nome">
            <input type="text" id="editFoto" placeholder="URL da Foto (opcional)" oninput="atualizarPreview()">
            <button class="btn-green" onclick="salvarPerfil()">Salvar</button>
        </div>
    </div>

    <div id="modalConfig" class="modal-bg">
        <div class="modal-box">
            <span class="close-btn" onclick="fecharModal('modalConfig')">&times;</span>
            <h3>Configura√ß√µes</h3>
            <div class="config-section">
                <h4>Suporte</h4>
                <a href="mailto:animalspicturehelp@gmail.com" style="color:var(--green)">animalspicturehelp@gmail.com</a>
            </div>
            <div class="config-section">
                <h4>Dados Locais</h4>
                <p style="font-size:12px; color:#aaa;">Se o site ficar lento, limpe o cache.</p>
                <button class="btn-green" style="background:#444;" onclick="limparDados()">üóëÔ∏è Limpar Todos os Posts</button>
            </div>
            <div class="config-section">
                <p style="font-size:12px;">Logado: <b id="userEmailDisplay">---</b></p>
                <button class="btn-green" style="background:var(--red);" onclick="logout()">Sair</button>
            </div>
        </div>
    </div>

    <script>
        // === 1. LISTA COMPLETA DE RA√áAS ===
        const CATEGORIAS = {
            "C√£es": ["Vira-lata (SRD)", "Labrador", "Poodle", "Bulldog", "Golden Retriever", "Pastor Alem√£o", "Shih Tzu", "Yorkshire", "Pug", "Rottweiler", "Husky", "Pinscher", "Beagle", "Chow Chow"],
            "Gatos": ["Vira-lata (SRD)", "Siam√™s", "Persa", "Maine Coon", "Sphynx", "Angor√°", "Bengal", "Ragdoll"],
            "P√°ssaros": ["Calopsita", "Can√°rio", "Papagaio", "Periquito", "Arara", "Cacatua", "Agapornis"],
            "Roedores": ["Hamster", "Porquinho da √çndia", "Chinchila", "Coelho", "Gerbil"],
            "Outros": ["Tartaruga", "Iguana", "Cobra", "Betta", "Cavalo", "Ex√≥tico"]
        };

        const ADMIN_EMAIL = "jarvismorato@gmail.com"; 
        const LIMITE = 29;
        let usuario = { nome: "", foto: "", email: "", premium: false };
        let postsHoje = 0;
        let contadorSessao = 0;

        window.onload = function() {
            google.accounts.id.initialize({
                client_id: "1011026636052-883kh3h1md3m98tpvgvm5gqlie40lecc.apps.googleusercontent.com",
                callback: handleLogin
            });
            google.accounts.id.renderButton(document.getElementById("googleBtn"), { theme: "outline", size: "large", type: "icon" });

            carregarDados();
            initCategorias();
            renderizarFeedCompleto();
        };

        // === 2. SISTEMA DE BANCO DE DADOS LOCAL (LocalStorage) ===
        function getDB() { return JSON.parse(localStorage.getItem('db_posts') || '[]'); }
        function saveDB(posts) {
            try { localStorage.setItem('db_posts', JSON.stringify(posts)); } 
            catch (e) { alert("Mem√≥ria cheia! Limpe dados nas configura√ß√µes."); }
        }

        // === 3. RENDERIZA√á√ÉO DO FEED ===
        function renderizarFeedCompleto() {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            
            // Post Demo
            criarPostHTML({
                id: 'demo', nome: 'Admin', 
                foto: 'https://ui-avatars.com/api/?name=Admin&background=random', 
                desc: 'Bem-vindo! Seus posts agora ficam salvos no seu PC! üíæ', 
                img: 'https://images.unsplash.com/photo-1533738363-b7f9aef128ce?w=600&q=80', 
                cat: 'Sistema', sub: 'Info', admin: true
            });

            // Posts Salvos
            const posts = getDB();
            posts.forEach(p => criarPostHTML(p));
        }

        function criarPostHTML(post) {
            const div = document.createElement('div');
            div.className = 'card post';
            div.setAttribute('data-cat', post.cat);
            div.setAttribute('data-id', post.id);
            
            const userPic = post.foto || avatarFallback(post.nome);
            let badge = "";
            let borderClass = "";
            if(post.admin || post.email === ADMIN_EMAIL) { 
                badge = " <span class='badge-admin'>DONO</span>"; borderClass = "admin-border"; 
            }

            div.innerHTML = `
                <div class="post-header">
                    <div class="post-user">
                        <img src="${userPic}" class="post-avatar ${borderClass}" onerror="this.src='${avatarFallback(post.nome)}'">
                        <div><b>${post.nome}${badge}</b></div>
                    </div>
                    <button class="btn-icon" style="border:none; color:red;" onclick="deletarPost('${post.id}')">üóëÔ∏è</button>
                </div>
                <p>${post.desc}</p>
                <span style="font-size:11px; background:#333; padding:4px 8px; border-radius:4px;">${post.cat} > ${post.sub}</span>
                <img src="${post.img}" loading="lazy">
                <div class="post-comments">
                    <div class="comments-list" id="list-${post.id}"></div>
                    ${usuario.email ? 
                    `<div class="comment-form">
                        <input type="text" class="comment-text" placeholder="Comente..." id="input-${post.id}">
                        <button class="btn-comment" onclick="addComentario('${post.id}')">></button>
                    </div>` : '<small>Logue para comentar</small>'}
                </div>
            `;
            document.getElementById('feed').appendChild(div); 
            carregarComentarios(post.id);
        }

        // === 4. PUBLICAR ===
        function publicar(e) {
            e.preventDefault();
            if(!usuario.premium && !isAdmin() && postsHoje >= LIMITE) {
                alert("Limite atingido!"); abrirModal('modalPremium'); return;
            }

            const desc = document.getElementById('descPost').value;
            const img = document.getElementById('finalImageBase64').value;
            const cat = document.getElementById('catSelect').value;
            const sub = document.getElementById('subSelect').value;

            if(!img) return alert("Escolha uma foto!");
            if(!cat || !sub) return alert("Selecione Categoria/Ra√ßa");

            const novoPost = {
                id: 'post_' + Date.now(),
                nome: usuario.nome,
                foto: usuario.foto,
                email: usuario.email,
                desc: desc,
                img: img,
                cat: cat,
                sub: sub,
                data: new Date().toISOString()
            };

            const posts = getDB();
            posts.unshift(novoPost);
            saveDB(posts);
            renderizarFeedCompleto();

            if(!usuario.premium && !isAdmin()) {
                postsHoje++; localStorage.setItem('app_qtd', postsHoje);
                contadorSessao++;
                if(contadorSessao % 10 === 0) inserirAnuncio();
                atualizarLimite();
            }
            
            e.target.reset();
            document.getElementById('previewUpload').style.display = 'none';
            document.getElementById('finalImageBase64').value = "";
        }

        function deletarPost(id) {
            if(!confirm("Apagar post?")) return;
            if(id === 'demo') return alert("Post demo n√£o pode ser apagado.");
            let posts = getDB();
            const post = posts.find(p => p.id === id);
            if(post && (post.email === usuario.email || isAdmin())) {
                posts = posts.filter(p => p.id !== id);
                saveDB(posts);
                renderizarFeedCompleto();
            } else {
                alert("Voc√™ s√≥ pode apagar seus posts.");
            }
        }

        // === 5. COMENT√ÅRIOS E FOTOS ===
        function addComentario(postID) {
            const input = document.getElementById(`input-${postID}`);
            const texto = input.value;
            if(!texto) return;
            const pic = usuario.foto || avatarFallback(usuario.nome);
            const novo = { user: usuario.nome, foto: pic, text: texto };
            let todos = JSON.parse(localStorage.getItem('comments') || '{}');
            if(!todos[postID]) todos[postID] = [];
            todos[postID].push(novo);
            localStorage.setItem('comments', JSON.stringify(todos));
            renderComentario(postID, novo);
            input.value = '';
        }

        function carregarComentarios(postID) {
            let todos = JSON.parse(localStorage.getItem('comments') || '{}');
            if(todos[postID]) todos[postID].forEach(c => renderComentario(postID, c));
        }

        function renderComentario(postID, c) {
            const list = document.getElementById(`list-${postID}`);
            const div = document.createElement('div');
            div.className = 'comment-item';
            div.innerHTML = `<img src="${c.foto}" class="comment-avatar" onerror="this.src='${avatarFallback(c.user)}'"><div class="comment-text"><b>${c.user}:</b> ${c.text}</div>`;
            list.appendChild(div);
        }

        function lerArquivo(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('previewUpload').src = e.target.result;
                    document.getElementById('previewUpload').style.display = 'block';
                    comprimirImagem(e.target.result);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function comprimirImagem(base64Str) {
            const img = new Image();
            img.src = base64Str;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const maxWidth = 600;
                let width = img.width; let height = img.height;
                if (width > maxWidth) { height *= maxWidth / width; width = maxWidth; }
                canvas.width = width; canvas.height = height;
                ctx.drawImage(img, 0, 0, width, height);
                document.getElementById('finalImageBase64').value = canvas.toDataURL('image/jpeg', 0.6);
            };
        }

        // === 6. UTILIT√ÅRIOS ===
        function handleLogin(res) {
            const data = decodeJwt(res.credential);
            const fotoSalva = localStorage.getItem('app_foto');
            usuario.foto = fotoSalva ? fotoSalva : data.picture;
            usuario.nome = localStorage.getItem('app_nome') || data.name;
            usuario.email = data.email;
            localStorage.setItem('app_email', usuario.email);
            if(!fotoSalva) localStorage.setItem('app_foto', usuario.foto);
            atualizarUI();
        }

        function carregarDados() {
            usuario.nome = localStorage.getItem('app_nome');
            usuario.foto = localStorage.getItem('app_foto');
            usuario.email = localStorage.getItem('app_email');
            usuario.premium = localStorage.getItem('app_premium') === 'true';
            let hoje = new Date().toLocaleDateString();
            if(localStorage.getItem('app_data') !== hoje) { postsHoje = 0; localStorage.setItem('app_data', hoje); }
            else { postsHoje = parseInt(localStorage.getItem('app_qtd') || 0); }
            atualizarUI();
        }

        function atualizarUI() {
            if(usuario.email) {
                document.getElementById('googleBtn').style.display = 'none';
                document.getElementById('loggedArea').style.display = 'flex';
                document.getElementById('postBox').style.display = 'block';
                document.getElementById('headerImg').src = usuario.foto;
                document.getElementById('editNome').value = usuario.nome;
                document.getElementById('editFoto').value = usuario.foto;
                document.getElementById('previewImg').src = usuario.foto;
                document.getElementById('userEmailDisplay').innerText = usuario.email;
                const img = document.getElementById('headerImg');
                img.className = '';
                if(isAdmin()) img.classList.add('admin-border');
                else if(usuario.premium) img.classList.add('premium-border');
            }
            atualizarLimite();
        }

        function isAdmin() { return usuario.email && (usuario.email.trim().toLowerCase() === ADMIN_EMAIL.trim().toLowerCase()); }
        function avatarFallback(n) { return `https://ui-avatars.com/api/?name=${encodeURIComponent(n||'U')}&background=1e1e1e&color=00C853`; }
        function decodeJwt(t) { return JSON.parse(decodeURIComponent(window.atob(t.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''))); }

        function initCategorias() {
            const sel = document.getElementById('catSelect');
            const top = document.getElementById('topicBar');
            for(let c in CATEGORIAS) {
                sel.innerHTML += `<option value="${c}">${c}</option>`;
                top.innerHTML += `<button class="topic-btn" onclick="filter('${c}', this)">${c}</button>`;
            }
        }
        function carregarSub() {
            const c = document.getElementById('catSelect').value;
            const s = document.getElementById('subSelect');
            s.innerHTML = '<option value="">Ra√ßa...</option>';
            s.disabled = !c;
            if(c) CATEGORIAS[c].forEach(r => s.innerHTML += `<option value="${r}">${r}</option>`);
        }
        function filter(cat, btn) {
            document.querySelectorAll('.topic-btn').forEach(b=>b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            document.querySelectorAll('.post').forEach(p => {
                p.style.display = (cat === 'Tudo' || p.getAttribute('data-cat') === cat) ? 'block' : 'none';
            });
        }

        // === PROTE√á√ÉO DO AN√öNCIO (CORRE√á√ÉO DO BUG VISUAL) ===
        function inserirAnuncio() {
            const div = document.createElement('div');
            div.className = 'card post post-ad';
            // Usando concatena√ß√£o para enganar o navegador e n√£o quebrar o c√≥digo
            const scriptTag = '<scr' + 'ipt>(adsbygoogle = window.adsbygoogle || []).push({});</scr' + 'ipt>';
            div.innerHTML = `<span style="background:#FFD700;color:black;font-weight:bold;">AD</span><br><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6566744182494017" data-ad-slot="SEU_SLOT" data-ad-format="auto" data-full-width-responsive="true"></ins>` + scriptTag + `<small onclick="abrirModal('modalPremium')">Remover</small>`;
            document.getElementById('feed').prepend(div);
        }

        function salvarPerfil() {
            usuario.nome = document.getElementById('editNome').value;
            usuario.foto = document.getElementById('editFoto').value;
            localStorage.setItem('app_nome', usuario.nome); 
            localStorage.setItem('app_foto', usuario.foto);
            atualizarUI(); fecharModal('modalPerfil');
        }
        function atualizarPreview() { document.getElementById('previewImg').src = document.getElementById('editFoto').value; }
        function atualizarLimite() { document.getElementById('limitDisplay').innerText = (isAdmin() || usuario.premium) ? "Ilimitado ‚ú®" : `Restam ${LIMITE - postsHoje} posts`; }
        function abrirModal(id) { document.getElementById(id).classList.add('open'); }
        function fecharModal(id) { document.getElementById(id).classList.remove('open'); }
        function logout() { localStorage.clear(); location.reload(); }
        function limparDados() { if(confirm("Apagar todos os posts salvos?")) { localStorage.removeItem('db_posts'); location.reload(); } }
        function assinarPremium() { if(confirm("Pagar R$ 2,99?")) { usuario.premium = true; localStorage.setItem('app_premium', 'true'); atualizarUI(); fecharModal('modalPremium'); } }
    </script>
</body>
</html>