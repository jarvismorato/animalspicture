<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animals Picture - V21</title>
    <meta name="description" content="Rede social local com temas e idiomas.">
    <meta name="theme-color" content="#121212">
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6566744182494017" crossorigin="anonymous"></script>

    <style>
        /* === TEMA ESCURO (PADR√ÉO) === */
        :root {
            --bg: #121212; --card: #1e1e1e; --text: #e0e0e0;
            --border: #333; --green: #00C853; --red: #D50000; --gold: #FFD700;
            --input-bg: #2c2c2c;
        }

        /* === TEMA CLARO (ATIVADO VIA CLASSE) === */
        body.light-theme {
            --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21;
            --border: #ddd; --input-bg: #f0f2f5;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; transition: background 0.3s, color 0.3s; }
        
        header { width: 100%; height: 70px; background: var(--card); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-sizing: border-box; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; transition: background 0.3s; }
        .logo { font-size: 22px; font-weight: 800; color: var(--green); margin: 0; }
        .logo span { color: var(--text); }
        .header-actions { display: flex; align-items: center; gap: 12px; }

        .btn-icon { background: transparent; border: 1px solid var(--border); color: var(--text); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: 0.2s; }
        .btn-icon:hover { background: rgba(0, 200, 83, 0.1); border-color: var(--green); }
        .btn-premium { border-color: var(--gold); color: var(--gold); background: rgba(255, 215, 0, 0.1); }
        .user-mini img { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--green); cursor: pointer; object-fit: cover; }
        
        .topic-bar { width: 100%; background: var(--bg); border-bottom: 1px solid var(--border); display: flex; gap: 10px; padding: 12px; overflow-x: auto; position: sticky; top: 70px; z-index: 90; transition: background 0.3s; }
        .topic-btn { background: var(--card); border: 1px solid var(--border); color: #888; padding: 8px 18px; border-radius: 20px; cursor: pointer; white-space: nowrap; flex-shrink: 0; }
        .topic-btn:hover { background: var(--border); }
        .topic-btn.active { background: var(--green); color: white; border-color: var(--green); font-weight: bold; }

        main { width: 100%; max-width: 600px; padding: 20px 10px; padding-bottom: 80px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 25px; transition: background 0.3s; }
        
        /* CONTE√öDO EST√ÅTICO */
        .static-content { background: var(--card); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border); }
        .static-content h2 { color: var(--green); margin-top: 0; }
        .static-content p, .static-content ul { font-size: 14px; color: var(--text); opacity: 0.8; line-height: 1.6; }
        .footer-legal { font-size: 11px; color: #888; text-align: center; margin-top: 30px; border-top: 1px solid var(--border); padding-top: 10px; }

        input, textarea, select { width: 100%; background: var(--input-bg); border: 1px solid var(--border); color: var(--text); padding: 12px; border-radius: 8px; margin: 8px 0; box-sizing: border-box; font-family: inherit; }
        .btn-green { width: 100%; background: var(--green); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .file-upload-label { display: flex; align-items: center; justify-content: center; gap: 10px; background: var(--input-bg); border: 2px dashed var(--border); padding: 20px; border-radius: 12px; cursor: pointer; color: var(--text); font-weight:bold; font-size: 15px; margin: 15px 0; transition: 0.3s; }
        .file-upload-label:hover { border-color: var(--green); }
        #previewUpload { width: 100%; border-radius: 8px; margin-top: 10px; display: none; object-fit: contain; max-height: 300px; border: 1px solid var(--border); }

        .post img { width: 100%; border-radius: 10px; margin-top: 10px; }
        .post-header { display: flex; align-items: center; justify-content: space-between; }
        .post-user { display: flex; align-items: center; gap: 10px; }
        .post-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .badge-admin { background: var(--red); color: white; font-size: 9px; padding: 2px 6px; border-radius: 4px; margin-left: 5px; font-weight: bold; }
        
        .post-actions-bar { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--border); }
        .action-btn { background: none; border: none; color: #888; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 14px; padding: 5px 10px; border-radius: 20px; }
        .btn-like.liked { color: var(--red); }
        .btn-delete { color: var(--red); }
        .btn-report { color: var(--gold); }
        
        .post-comments { margin-top: 10px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; }
        .comment-item { display: flex; gap: 10px; margin-bottom: 8px; font-size: 13px; }
        .comment-avatar { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; }
        .comment-text { color: var(--text); opacity: 0.9; }
        .comment-form { display: flex; gap: 8px; margin-top: 10px; }

        .modal-bg { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        .modal-bg.open { display: flex; }
        .modal-box { background: var(--card); width: 90%; max-width: 400px; padding: 25px; border-radius: 16px; border: 1px solid var(--border); position: relative; max-height: 80vh; overflow-y: auto; color: var(--text); }
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer; color: var(--text); opacity: 0.5; }
        .config-section { border-top: 1px solid var(--border); margin-top: 15px; padding-top: 15px; }
        .config-section h4 { margin-top: 0; color: var(--green); font-size: 14px; text-transform: uppercase; }
        .premium-border { border: 2px solid var(--gold) !important; }
        .admin-border { border: 2px solid var(--red) !important; }
        .post-ad { border: 2px dashed var(--border); background: rgba(0,0,0,0.1); text-align: center; }
    </style>
</head>
<body>

    <header>
        <div class="logo">Animals <span>Picture</span></div>
        <div class="header-actions">
            <button class="btn-icon btn-premium" onclick="abrirModal('modalPremium')" title="Premium">üíé</button>
            <button class="btn-icon" onclick="abrirModal('modalConfig')" title="Config">‚öôÔ∏è</button>
            <div id="googleBtn"></div>
            <div class="user-mini" id="loggedArea" onclick="abrirModal('modalPerfil')" style="display:none;">
                <img id="headerImg" src="" alt="Eu">
            </div>
        </div>
    </header>

    <nav id="topicBar" class="topic-bar">
        <button class="topic-btn active" onclick="filtrarFeed('Tudo', this)" data-i18n="all">Tudo</button>
    </nav>

    <main>
        <div class="static-content">
            <h2 data-i18n="welcomeTitle">Bem-vindo √† Animals Picture</h2>
            <p data-i18n="welcomeDesc">Animals Picture √© a comunidade l√≠der para amantes de animais. Compartilhe fotos, descubra ra√ßas e fa√ßa amigos.</p>
        </div>

        <div id="postBox" class="card" style="display:none;">
            <h3 data-i18n="newPost">Nova Publica√ß√£o üêæ</h3>
            <form onsubmit="publicar(event)">
                <textarea id="descPost" rows="2" required></textarea>
                <div style="display:flex; gap:10px; margin:10px 0;">
                    <select id="catSelect" required onchange="carregarSub()"><option value="">Categoria...</option></select>
                    <select id="subSelect" disabled required><option value="">Ra√ßa...</option></select>
                </div>
                <label class="file-upload-label">
                    <input type="file" id="fileInput" accept="image/*" capture="environment" style="display:none;" onchange="lerArquivo(this)">
                    <span style="font-size:20px;">üì∏</span><span data-i18n="cameraBtn">C√¢mera / Galeria</span>
                </label>
                <img id="previewUpload" src="">
                <input type="hidden" id="finalImageBase64">
                <button class="btn-green" data-i18n="publishBtn">Publicar</button>
                <div id="limitDisplay" style="font-size:12px; color:#888; margin-top:5px; text-align:center;"></div>
            </form>
        </div>

        <div id="feed"></div>

        <div class="footer-legal">
            <p>&copy; 2024 Animals Picture. <span data-i18n="rights">Todos os direitos reservados.</span></p>
        </div>
    </main>

    <div id="modalPremium" class="modal-bg"><div class="modal-box"><span class="close-btn" onclick="fecharModal('modalPremium')">&times;</span><h2 style="color:var(--gold)">Premium üíé</h2><p>R$ 2,99 / <span data-i18n="month">m√™s</span></p><button class="btn-green" style="background:var(--gold); color:black;" onclick="assinarPremium()" data-i18n="subscribe">Assinar Agora</button></div></div>
    
    <div id="modalPerfil" class="modal-bg"><div class="modal-box"><span class="close-btn" onclick="fecharModal('modalPerfil')">&times;</span><h3 data-i18n="profile">Perfil</h3><img id="previewImg" src="" style="width:80px; height:80px; border-radius:50%; margin:10px auto; display:block; object-fit:cover;"><input type="text" id="editNome" placeholder="Nome"><input type="text" id="editFoto" placeholder="URL da Foto" oninput="atualizarPreview()"><button class="btn-green" onclick="salvarPerfil()" data-i18n="save">Salvar</button></div></div>
    
    <div id="modalConfig" class="modal-bg">
        <div class="modal-box">
            <span class="close-btn" onclick="fecharModal('modalConfig')">&times;</span>
            <h3 data-i18n="config">Configura√ß√µes</h3>
            
            <div class="config-section">
                <h4 data-i18n="lang">Idioma</h4>
                <select id="selectIdioma" onchange="mudarIdioma(this.value)">
                    <option value="pt">Portugu√™s</option>
                    <option value="en">English</option>
                    <option value="es">Espa√±ol</option>
                </select>
            </div>

            <div class="config-section">
                <h4 data-i18n="theme">Tema</h4>
                <select id="selectTema" onchange="mudarTema(this.value)">
                    <option value="dark">Escuro (Dark)</option>
                    <option value="light">Claro (Light)</option>
                </select>
            </div>

            <div class="config-section"><h4 data-i18n="support">Suporte</h4><a href="mailto:animalspicturehelp@gmail.com" style="color:var(--green)">animalspicturehelp@gmail.com</a></div>
            <div class="config-section"><h4 data-i18n="localData">Dados Locais</h4><button class="btn-green" style="background:#444;" onclick="limparDados()" data-i18n="clearData">üóëÔ∏è Limpar Tudo</button></div>
            <div class="config-section"><p style="font-size:12px;">Log: <b id="userEmailDisplay">---</b></p><button class="btn-green" style="background:var(--red);" onclick="logout()" data-i18n="logout">Sair</button></div>
        </div>
    </div>

    <script>
        // === TRADU√á√ïES ===
        const TRANSLATIONS = {
            pt: {
                all: "Tudo", welcomeTitle: "Bem-vindo √† Animals Picture", welcomeDesc: "Animals Picture √© a comunidade l√≠der para amantes de animais.",
                newPost: "Nova Publica√ß√£o üêæ", cameraBtn: "C√¢mera / Galeria", publishBtn: "Publicar", rights: "Todos os direitos reservados.",
                month: "m√™s", subscribe: "Assinar Agora", profile: "Perfil", save: "Salvar", config: "Configura√ß√µes",
                lang: "Idioma", theme: "Tema", support: "Suporte", localData: "Dados Locais", clearData: "üóëÔ∏è Limpar Tudo", logout: "Sair",
                catPlace: "Categoria...", racePlace: "Ra√ßa...", descPlace: "Escreva algo...", delete: "Excluir", report: "Denunciar"
            },
            en: {
                all: "All", welcomeTitle: "Welcome to Animals Picture", welcomeDesc: "Animals Picture is the leading community for animal lovers.",
                newPost: "New Post üêæ", cameraBtn: "Camera / Gallery", publishBtn: "Publish", rights: "All rights reserved.",
                month: "month", subscribe: "Subscribe Now", profile: "Profile", save: "Save", config: "Settings",
                lang: "Language", theme: "Theme", support: "Support", localData: "Local Data", clearData: "üóëÔ∏è Clear All", logout: "Logout",
                catPlace: "Category...", racePlace: "Breed...", descPlace: "Write something...", delete: "Delete", report: "Report"
            },
            es: {
                all: "Todo", welcomeTitle: "Bienvenido a Animals Picture", welcomeDesc: "Animals Picture es la comunidad l√≠der para amantes de los animales.",
                newPost: "Nueva Publicaci√≥n üêæ", cameraBtn: "C√°mara / Galer√≠a", publishBtn: "Publicar", rights: "Todos los derechos reservados.",
                month: "mes", subscribe: "Suscribirse", profile: "Perfil", save: "Guardar", config: "Configuraci√≥n",
                lang: "Idioma", theme: "Tema", support: "Soporte", localData: "Datos Locales", clearData: "üóëÔ∏è Borrar Todo", logout: "Cerrar Sesi√≥n",
                catPlace: "Categor√≠a...", racePlace: "Raza...", descPlace: "Escribe algo...", delete: "Eliminar", report: "Reportar"
            }
        };

        const CATEGORIAS = {
            "C√£es": ["Vira-lata", "Labrador", "Poodle", "Bulldog", "Golden", "Pastor Alem√£o", "Shih Tzu", "Yorkshire", "Pug", "Rottweiler", "Husky", "Pinscher", "Beagle", "Pitbull"],
            "Gatos": ["Vira-lata", "Siam√™s", "Persa", "Maine Coon", "Sphynx", "Angor√°", "Bengal", "Ragdoll"],
            "P√°ssaros": ["Calopsita", "Can√°rio", "Papagaio", "Periquito", "Arara", "Cacatua"],
            "Outros": ["Hamster", "Coelho", "Tartaruga", "Peixe", "Cavalo", "Ex√≥tico"]
        };
        const ADMIN_EMAIL = "jarvismorato@gmail.com"; 
        const LIMITE = 29;
        let usuario = { nome: "", foto: "", email: "", premium: false };
        let postsHoje = 0, contadorSessao = 0;
        let idiomaAtual = localStorage.getItem('app_lang') || 'pt';

        window.onload = function() {
            google.accounts.id.initialize({ client_id: "1011026636052-883kh3h1md3m98tpvgvm5gqlie40lecc.apps.googleusercontent.com", callback: handleLogin });
            google.accounts.id.renderButton(document.getElementById("googleBtn"), { theme: "outline", size: "large", type: "icon" });
            
            // Carrega Tema e Idioma Salvos
            const temaSalvo = localStorage.getItem('app_theme') || 'dark';
            mudarTema(temaSalvo);
            document.getElementById('selectTema').value = temaSalvo;
            
            mudarIdioma(idiomaAtual);

            carregarDados(); initCategorias(); renderizarFeed();
        };

        // === IDIOMA & TEMA ===
        function mudarIdioma(lang) {
            idiomaAtual = lang;
            localStorage.setItem('app_lang', lang);
            document.getElementById('selectIdioma').value = lang;
            
            const t = TRANSLATIONS[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const k = el.getAttribute('data-i18n');
                if(t[k]) el.innerText = t[k];
            });
            document.getElementById('descPost').placeholder = t.descPlace;
            document.getElementById('catSelect').options[0].text = t.catPlace;
            document.getElementById('subSelect').options[0].text = t.racePlace;
            renderizarFeed(); // Atualiza bot√µes do feed
        }

        function mudarTema(tema) {
            if(tema === 'light') document.body.classList.add('light-theme');
            else document.body.classList.remove('light-theme');
            localStorage.setItem('app_theme', tema);
        }

        // === BANCO DE DADOS ===
        function getDB() { return JSON.parse(localStorage.getItem('db_posts_v3') || '[]'); }
        function saveDB(posts) { try { localStorage.setItem('db_posts_v3', JSON.stringify(posts)); } catch(e) { alert("Mem√≥ria cheia!"); } }

        function renderizarFeed() {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            
            const t = TRANSLATIONS[idiomaAtual];

            // Post Demo
            criarPostHTML({
                id: 'demo', nome: 'Admin', foto: 'https://ui-avatars.com/api/?name=Admin', 
                desc: 'Hello World! üåç Bem-vindo √† V21.', 
                img: 'https://images.unsplash.com/photo-1533738363-b7f9aef128ce?w=600&q=80', 
                cat: 'Sistema', sub: 'Info', admin: true, likes: []
            });

            const posts = getDB();
            posts.forEach(p => criarPostHTML(p));
        }

        function criarPostHTML(post) {
            if (!post.likes) post.likes = [];
            const div = document.createElement('div');
            div.className = 'card post';
            div.setAttribute('data-id', post.id);
            div.setAttribute('data-cat', post.cat);
            
            const userPic = post.foto || avatarFallback(post.nome);
            let badge = (post.admin || post.email === ADMIN_EMAIL) ? " <span class='badge-admin'>DONO</span>" : "";
            let border = (post.admin || post.email === ADMIN_EMAIL) ? "admin-border" : (post.premium ? "premium-border" : "");

            const isOwner = (usuario.email && post.email === usuario.email) || isAdmin();
            const t = TRANSLATIONS[idiomaAtual];
            
            let actionBtn = isOwner 
                ? `<button class="action-btn btn-delete" onclick="deletarPost('${post.id}')">üóëÔ∏è ${t.delete}</button>`
                : `<button class="action-btn btn-report" onclick="denunciarPost('${post.id}')">‚ö†Ô∏è ${t.report}</button>`;

            const liked = post.likes.includes(usuario.email);
            const likeIcon = liked ? "‚ù§Ô∏è" : "ü§ç";
            const likeClass = liked ? "btn-like liked" : "btn-like";

            div.innerHTML = `
                <div class="post-header">
                    <div class="post-user">
                        <img src="${userPic}" class="post-avatar ${border}" onerror="this.src='${avatarFallback(post.nome)}'">
                        <div><b>${post.nome}${badge}</b></div>
                    </div>
                </div>
                <p>${post.desc}</p>
                <span style="font-size:11px; opacity:0.7; border:1px solid var(--border); padding:2px 6px; border-radius:4px;">${post.cat} > ${post.sub}</span>
                <img src="${post.img}" loading="lazy">
                
                <div class="post-actions-bar">
                    <button class="action-btn ${likeClass}" onclick="toggleLike('${post.id}')">${likeIcon} ${post.likes.length}</button>
                    ${actionBtn}
                </div>

                <div class="post-comments">
                    <div class="comments-list" id="list-${post.id}"></div>
                    ${usuario.email ? 
                    `<div class="comment-form">
                        <input type="text" class="comment-text" placeholder="..." id="input-${post.id}" style="width:100%;">
                        <button class="btn-green" style="margin:0; padding:5px 10px;" onclick="addComentario('${post.id}')">></button>
                    </div>` : ''}
                </div>
            `;
            document.getElementById('feed').appendChild(div);
            carregarComentarios(post.id);
        }

        function toggleLike(id) {
            if (!usuario.email) return alert("Login necess√°rio!");
            if (id === 'demo') return;
            let posts = getDB();
            let idx = posts.findIndex(p => p.id === id);
            if (idx === -1) return;
            let post = posts[idx];
            if (!post.likes) post.likes = [];
            
            if (post.likes.includes(usuario.email)) post.likes = post.likes.filter(e => e !== usuario.email);
            else post.likes.push(usuario.email);
            
            posts[idx] = post;
            saveDB(posts);
            renderizarFeed();
        }

        function publicar(e) {
            e.preventDefault();
            if(!usuario.premium && !isAdmin() && postsHoje >= LIMITE) return alert("Limite!"); 
            const desc = document.getElementById('descPost').value;
            const img = document.getElementById('finalImageBase64').value;
            const cat = document.getElementById('catSelect').value;
            const sub = document.getElementById('subSelect').value;
            if(!img || !cat) return alert("Foto/Categoria?");

            const novo = { id: 'post_'+Date.now(), nome: usuario.nome, foto: usuario.foto, email: usuario.email, desc, img, cat, sub, likes: [], date: new Date().toISOString() };
            const posts = getDB();
            posts.unshift(novo);
            saveDB(posts);
            renderizarFeed();

            if(!usuario.premium && !isAdmin()) {
                postsHoje++; localStorage.setItem('app_qtd', postsHoje);
                contadorSessao++;
                if(contadorSessao % 10 === 0) inserirAnuncio();
                atualizarLimite();
            }
            e.target.reset(); document.getElementById('previewUpload').style.display = 'none';
        }

        function deletarPost(id) {
            if(!confirm("?")) return;
            let posts = getDB();
            posts = posts.filter(p => p.id !== id);
            saveDB(posts);
            renderizarFeed();
        }

        function denunciarPost(id) { alert("Reportado/Reported/Reportado!"); }

        function lerArquivo(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('previewUpload').src = e.target.result;
                    document.getElementById('previewUpload').style.display = 'block';
                    comprimir(e.target.result);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        function comprimir(base64) {
            const img = new Image(); img.src = base64;
            img.onload = function() {
                const cvs = document.createElement('canvas'); const ctx = cvs.getContext('2d');
                let w = img.width, h = img.height, max = 500;
                if(w > max){ h*=max/w; w=max; }
                cvs.width = w; cvs.height = h;
                ctx.drawImage(img,0,0,w,h);
                document.getElementById('finalImageBase64').value = cvs.toDataURL('image/jpeg', 0.6);
            };
        }

        function addComentario(id) {
            const txt = document.getElementById(`input-${id}`).value;
            if(!txt) return;
            const novo = { user: usuario.nome, text: txt, foto: usuario.foto };
            let all = JSON.parse(localStorage.getItem('comments_v3') || '{}');
            if(!all[id]) all[id] = [];
            all[id].push(novo);
            localStorage.setItem('comments_v3', JSON.stringify(all));
            carregarComentarios(id);
        }
        function carregarComentarios(id) {
            const list = document.getElementById(`list-${id}`);
            if(!list) return;
            list.innerHTML = '';
            let all = JSON.parse(localStorage.getItem('comments_v3') || '{}');
            if(all[id]) all[id].forEach(c => {
                list.innerHTML += `<div class="comment-item"><img src="${c.foto||avatarFallback(c.user)}" class="comment-avatar"><div><b>${c.user}</b>: ${c.text}</div></div>`;
            });
        }

        function handleLogin(res) {
            const d = decodeJwt(res.credential);
            usuario = { nome: d.name, foto: d.picture, email: d.email, premium: localStorage.getItem('app_premium')==='true' };
            localStorage.setItem('app_email', d.email); localStorage.setItem('app_nome', d.name); localStorage.setItem('app_foto', d.picture);
            atualizarUI();
        }
        function carregarDados() {
            usuario.nome = localStorage.getItem('app_nome'); usuario.foto = localStorage.getItem('app_foto');
            usuario.email = localStorage.getItem('app_email'); usuario.premium = localStorage.getItem('app_premium') === 'true';
            atualizarUI();
        }
        function atualizarUI() {
            if(usuario.email) {
                document.getElementById('googleBtn').style.display = 'none';
                document.getElementById('loggedArea').style.display = 'flex';
                document.getElementById('postBox').style.display = 'block';
                document.getElementById('headerImg').src = usuario.foto;
                document.getElementById('userEmailDisplay').innerText = usuario.email;
            }
            atualizarLimite(); renderizarFeed();
        }
        
        function isAdmin() { return usuario.email && usuario.email.trim().toLowerCase() === ADMIN_EMAIL.trim().toLowerCase(); }
        function avatarFallback(n) { return `https://ui-avatars.com/api/?name=${n}&background=1e1e1e&color=00C853`; }
        function decodeJwt(t) { return JSON.parse(decodeURIComponent(window.atob(t.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''))); }
        
        function initCategorias() {
            const sel = document.getElementById('catSelect'); const top = document.getElementById('topicBar');
            for(let c in CATEGORIAS) {
                sel.innerHTML += `<option value="${c}">${c}</option>`;
                top.innerHTML += `<button class="topic-btn" onclick="filter('${c}', this)">${c}</button>`;
            }
        }
        function carregarSub() {
            const c = document.getElementById('catSelect').value; const s = document.getElementById('subSelect');
            s.innerHTML = '<option value="">Ra√ßa...</option>'; s.disabled = !c;
            if(c) CATEGORIAS[c].forEach(r => s.innerHTML += `<option value="${r}">${r}</option>`);
        }
        function filter(cat, btn) {
            document.querySelectorAll('.topic-btn').forEach(b=>b.classList.remove('active')); if(btn) btn.classList.add('active');
            document.querySelectorAll('.post').forEach(p => p.style.display = (cat === 'Tudo' || p.getAttribute('data-cat') === cat) ? 'block' : 'none');
        }

        function inserirAnuncio() {
            const div = document.createElement('div'); div.className = 'card post post-ad';
            const sc = '<scr' + 'ipt>(adsbygoogle = window.adsbygoogle || []).push({});</scr' + 'ipt>';
            div.innerHTML = `<span style="background:#FFD700;color:black;">AD</span><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6566744182494017" data-ad-slot="SEU_SLOT" data-ad-format="auto" data-full-width-responsive="true"></ins>` + sc;
            document.getElementById('feed').prepend(div);
        }

        function salvarPerfil() {
            usuario.nome = document.getElementById('editNome').value; usuario.foto = document.getElementById('editFoto').value;
            localStorage.setItem('app_nome', usuario.nome); localStorage.setItem('app_foto', usuario.foto);
            atualizarUI(); fecharModal('modalPerfil');
        }
        function atualizarPreview() { document.getElementById('previewImg').src = document.getElementById('editFoto').value; }
        function atualizarLimite() { document.getElementById('limitDisplay').innerText = (isAdmin() || usuario.premium) ? "Ilimitado ‚ú®" : `Restam ${LIMITE - postsHoje} posts`; }
        function abrirModal(id) { document.getElementById(id).classList.add('open'); }
        function fecharModal(id) { document.getElementById(id).classList.remove('open'); }
        function logout() { localStorage.clear(); location.reload(); }
        function limparDados() { if(confirm("Zerar tudo?")) { localStorage.removeItem('db_posts_v3'); location.reload(); } }
        function assinarPremium() { if(confirm("Pagar R$ 2,99?")) { usuario.premium = true; localStorage.setItem('app_premium', 'true'); atualizarUI(); fecharModal('modalPremium'); } }
    </script>
</body>
</html>